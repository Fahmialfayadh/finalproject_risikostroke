<!-- ============================================ -->
<!-- BAGIAN RESULT             -->
<!-- ============================================ -->
{% extends "base.html" %}

{% block content %}

<div class="page-container">

    <!-- ============================================ -->
    <!-- SECTION: RINGKASAN HASIL RISIKO             -->
    <!-- ============================================ -->
    <section class="result-card">
        <div class="section-header" style="text-align: center; margin-bottom: 2rem;">
            <h2 class="section-title" style="justify-content: center;">{{ t('risk_summary') }}</h2>
            <p class="section-subtitle">
                {{ t('risk_subtitle') }}
            </p>
        </div>

        <div class="name-block" style="margin-bottom: 1.5rem;">
            <span style="font-size: 1.5rem; font-weight: 700; color: var(--text-main);">{{ data["name"] }}</span>
        </div>

        <!-- ============================================ -->
        <!-- HASIL UTAMA: Persentase & Level Risiko      -->
        <!-- ============================================ -->
        <div class="result-main">
            <!-- Tampilkan probabilitas dalam persen (dibulatkan 1 desimal) -->
            <div class="result-number">{{ (prob * 100) | round(1) }}%</div>

            <div class="result-label">{{ t('estimated_risk') }}</div>

            <!-- Level risiko (Level dinamis) -->
            <div class="result-level level-{{ level | lower }}">
                {{ level }} {{ t('risk_category') }}
            </div>

            <!-- Gauge bar visual -->
            <div class="gauge">
                <div class="gauge-fill" style="width: {{ (prob * 100) }}%;"></div>
            </div>

            <!-- Catatan penting -->
            <div class="result-note">
                {{ t('result_note') }}
            </div>
        </div>

        <!-- ============================================ -->
        <!-- DETAIL GRID: BMI & Kategori                 -->
        <!-- ============================================ -->
        <div class="detail-grid">
            <div><span class="detail-label">{{ t('bmi') }}</span> <span class="detail-value">{{ bmi | round(1) }}</span>
            </div>
            <div><span class="detail-label">{{ t('age_category') }}</span> <span class="detail-value">{{ bins[0]
                    }}</span></div>
            <div><span class="detail-label">{{ t('glucose_category') }}</span> <span class="detail-value">{{ bins[1]
                    }}</span>
            </div>
            <div><span class="detail-label">{{ t('bmi_category') }}</span> <span class="detail-value">{{ bins[2]
                    }}</span></div>
        </div>

        <!-- PDF DOWNLOAD FORM -->
        <div style="margin-top: 30px;">
            <form action="/download_pdf" method="POST" target="_blank">
                {% for key, value in data.items() %}
                <input type="hidden" name="{{ key }}" value="{{ value }}">
                {% endfor %}
                <button type="submit" class="submit-btn" style="background: var(--text-main); margin-top: 0;">
                    {{ t('download_pdf') }}
                </button>
            </form>
        </div>
    </section>

    <!-- ============================================ -->
    <!-- SECTION: INPUT DETAILS (DATA USER LENGKAP)  -->
    <!-- ============================================ -->
    <section class="detail-card">
        <div class="detail-header">
            <h3 class="detail-title">{{ t('input_details') }}</h3>
            <p class="detail-subtitle">
                {{ t('input_subtitle') }}
            </p>
        </div>

        <table class="detail-table">
            <thead>
                <tr>
                    <th>{{ t('field') }}</th>
                    <th>{{ t('value') }}</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{ t('full_name') }}</td>
                    <td>{{ data["name"] }}</td>
                </tr>
                <tr>
                    <td>{{ t('age') }}</td>
                    <td>{{ data["age"] }}</td>
                </tr>
                <tr>
                    <td>{{ t('gender') }}</td>
                    <td>{{ data["gender"] }}</td>
                </tr>
                <tr>
                    <td>{{ t('weight') }}</td>
                    <td>{{ data["weight"] }} kg</td>
                </tr>
                <tr>
                    <td>{{ t('height') }}</td>
                    <td>{{ data["height"] }} cm</td>
                </tr>
                <tr>
                    <td>{{ t('bmi') }}</td>
                    <td>{{ bmi | round(1) }}</td>
                </tr>
                <tr>
                    <td>{{ t('glucose') }}</td>
                    <td>{{ data["glucose"] }}</td>
                </tr>
                <tr>
                    <td>{{ t('hypertension') }}</td>
                    <td>{{ t('yes') if data["hypertension"] == 1 else t('no') }}</td>
                </tr>
                <tr>
                    <td>{{ t('heart_disease') }}</td>
                    <td>{{ t('yes') if data["heart_disease"] == 1 else t('no') }}</td>
                </tr>
                <tr>
                    <td>{{ t('ever_married') }}</td>
                    <td>{{ data["ever_married"] }}</td>
                </tr>
                <tr>
                    <td>{{ t('work_type') }}</td>
                    <td>{{ data["work_type"] }}</td>
                </tr>
                <tr>
                    <td>{{ t('residence') }}</td>
                    <td>{{ data["residence"] }}</td>
                </tr>
                <tr>
                    <td>{{ t('smoking_status') }}</td>
                    <td>{{ data["smoking"] }}</td>
                </tr>
            </tbody>
        </table>
    </section>

    <!-- ============================================ -->
    <!-- SECTION: KONTRIBUSI FITUR MODEL             -->
    <!-- ============================================ -->
    <section class="detail-card">
        <div class="detail-header">
            <h3 class="detail-title">{{ t('model_contributions') }}</h3>
            <p class="detail-subtitle">
                {{ t('contrib_subtitle') }}
            </p>
        </div>

        <!-- Tabel kontribusi setiap fitur -->
        <table class="detail-table">
            <thead>
                <tr>
                    <th>{{ t('feature') }}</th>
                    <th>{{ t('contribution') }}</th>
                </tr>
            </thead>
            <tbody>
                <!-- Loop semua fitur dan kontribusinya -->
                {% for k, v in contrib.items() %}
                <tr>
                    <td>{{ k }}</td>
                    <td>{{ v | round(4) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

</div>

{% endblock %}