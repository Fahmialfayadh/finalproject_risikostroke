<!-- ============================================ -->
<!-- BAGIAN RESULT             -->
<!-- ============================================ -->
{% extends "base.html" %}

{% block content %}

<div class="page-container">

    <!-- ============================================ -->
    <!-- SECTION: RINGKASAN HASIL RISIKO             -->
    <!-- ============================================ -->
    <section class="result-card">
        <div class="section-header" style="text-align: center; margin-bottom: 2rem;">
            <h2 class="section-title" style="justify-content: center;">Risk Summary</h2>
            <p class="section-subtitle">
                Estimated probability of stroke given the submitted profile.
            </p>
        </div>

        <div class="name-block" style="margin-bottom: 1.5rem;">
            <span style="font-size: 1.5rem; font-weight: 700; color: var(--text-main);">{{ data["name"] }}</span>
        </div>

        <!-- ============================================ -->
        <!-- HASIL UTAMA: Persentase & Level Risiko      -->
        <!-- ============================================ -->
        <div class="result-main">
            <!-- Tampilkan probabilitas dalam persen (dibulatkan 1 desimal) -->
            <div class="result-number">{{ (prob * 100) | round(1) }}%</div>

            <div class="result-label">Estimated stroke risk</div>

            <!-- Level risiko (Level dinamis) -->
            <div class="result-level level-{{ level | lower }}">
                {{ level }} risk category
            </div>

            <!-- Gauge bar visual -->
            <div class="gauge">
                <div class="gauge-fill" style="width: {{ (prob * 100) }}%;"></div>
            </div>

            <!-- Catatan penting -->
            <div class="result-note">
                This value reflects the model's predicted probability based on your inputs. It does not represent an
                absolute
                risk and should always be interpreted in context of clinical evaluation.
            </div>
        </div>

        <!-- ============================================ -->
        <!-- DETAIL GRID: BMI & Kategori                 -->
        <!-- ============================================ -->
        <div class="detail-grid">
            <div><span class="detail-label">BMI</span> <span class="detail-value">{{ bmi | round(1) }}</span></div>
            <div><span class="detail-label">Age category</span> <span class="detail-value">{{ bins[0] }}</span></div>
            <div><span class="detail-label">Glucose category</span> <span class="detail-value">{{ bins[1] }}</span>
            </div>
            <div><span class="detail-label">BMI category</span> <span class="detail-value">{{ bins[2] }}</span></div>
        </div>

        <!-- PDF DOWNLOAD FORM -->
        <div style="margin-top: 30px;">
            <form action="/download_pdf" method="POST" target="_blank">
                {% for key, value in data.items() %}
                <input type="hidden" name="{{ key }}" value="{{ value }}">
                {% endfor %}
                <button type="submit" class="submit-btn" style="background: var(--text-main); margin-top: 0;">
                    Download Result PDF
                </button>
            </form>
        </div>
    </section>

    <!-- ============================================ -->
    <!-- SECTION: INPUT DETAILS (DATA USER LENGKAP)  -->
    <!-- ============================================ -->
    <section class="detail-card">
        <div class="detail-header">
            <h3 class="detail-title">Input Details</h3>
            <p class="detail-subtitle">
                Full profile information used for risk calculation.
            </p>
        </div>

        <table class="detail-table">
            <thead>
                <tr>
                    <th>Field</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Name</td>
                    <td>{{ data["name"] }}</td>
                </tr>
                <tr>
                    <td>Age</td>
                    <td>{{ data["age"] }}</td>
                </tr>
                <tr>
                    <td>Gender</td>
                    <td>{{ data["gender"] }}</td>
                </tr>
                <tr>
                    <td>Weight</td>
                    <td>{{ data["weight"] }} kg</td>
                </tr>
                <tr>
                    <td>Height</td>
                    <td>{{ data["height"] }} cm</td>
                </tr>
                <tr>
                    <td>BMI</td>
                    <td>{{ bmi | round(1) }}</td>
                </tr>
                <tr>
                    <td>Average Glucose</td>
                    <td>{{ data["glucose"] }}</td>
                </tr>
                <tr>
                    <td>Hypertension</td>
                    <td>{{ "Yes" if data["hypertension"] == 1 else "No" }}</td>
                </tr>
                <tr>
                    <td>Heart Disease</td>
                    <td>{{ "Yes" if data["heart_disease"] == 1 else "No" }}</td>
                </tr>
                <tr>
                    <td>Ever Married</td>
                    <td>{{ data["ever_married"] }}</td>
                </tr>
                <tr>
                    <td>Work Type</td>
                    <td>{{ data["work_type"] }}</td>
                </tr>
                <tr>
                    <td>Residence Type</td>
                    <td>{{ data["residence"] }}</td>
                </tr>
                <tr>
                    <td>Smoking Status</td>
                    <td>{{ data["smoking"] }}</td>
                </tr>
            </tbody>
        </table>
    </section>

    <!-- ============================================ -->
    <!-- SECTION: KONTRIBUSI FITUR MODEL             -->
    <!-- ============================================ -->
    <section class="detail-card">
        <div class="detail-header">
            <h3 class="detail-title">Model Feature Contributions</h3>
            <p class="detail-subtitle">
                Linear contributions of each feature (coefficient Ã— WOE) to the logit score.
            </p>
        </div>

        <!-- Tabel kontribusi setiap fitur -->
        <table class="detail-table">
            <thead>
                <tr>
                    <th>Feature</th>
                    <th>Contribution</th>
                </tr>
            </thead>
            <tbody>
                <!-- Loop semua fitur dan kontribusinya -->
                {% for k, v in contrib.items() %}
                <tr>
                    <td>{{ k }}</td>
                    <td>{{ v | round(4) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

</div>

{% endblock %}